# AWS Elastic Beanstalk Environment Configuration
# 
# This file contains the default environment variables for parse-hipaa deployment.
# 
# IMPORTANT: The following sensitive variables are NOT included here and must be set
# manually using 'eb setenv' command after deployment:
#   - PARSE_DASHBOARD_USERNAMES
#   - PARSE_DASHBOARD_USER_PASSWORDS
#   - PARSE_DASHBOARD_COOKIE_SESSION_SECRET
#   - PARSE_SERVER_APPLICATION_ID
#   - PARSE_SERVER_PRIMARY_KEY
#   - PARSE_SERVER_READ_ONLY_PRIMARY_KEY
#   - PARSE_SERVER_MAINTENANCE_KEY
#   - PARSE_SERVER_WEBHOOK_KEY
#   - PARSE_SERVER_ENCRYPTION_KEY
#   - PARSE_SERVER_DATABASE_URI (constructed from RDS environment variables)
#   - PARSE_SERVER_URL (set after deployment with your application URL)
#
# Optional variables that can be set based on your needs:
#   - PARSE_SERVER_REDIS_URL
#   - PARSE_SERVER_PUSH
#   - PARSE_SERVER_AUTH_PROVIDERS
#   - PARSE_SERVER_S3_BUCKET (recommended for production)
#   - AWS_ACCESS_KEY_ID (for S3)
#   - AWS_SECRET_ACCESS_KEY (for S3)
#
# See the README.md file for complete deployment instructions.

option_settings:
  # Application environment variables
  aws:elasticbeanstalk:application:environment:
    # Application name
    NEW_RELIC_APP_NAME: "parse-hipaa"
    
    # Cluster configuration
    CLUSTER_INSTANCES: "4"
    NODE_TLS_REJECT_UNAUTHORIZED: "1"
    
    # Dashboard configuration
    PARSE_DASHBOARD_START: "true"
    PARSE_DASHBOARD_USER_PASSWORD_ENCRYPTED: "true"
    PARSE_DASHBOARD_ALLOW_INSECURE_HTTP: "1"
    PARSE_DASHBOARD_MOUNT_PATH: "/dashboard"
    
    # Parse Server configuration
    PARSE_SERVER_ENABLE: "true"
    PARSE_SERVER_TRUST_PROXY: "true"
    PARSE_SERVER_MOUNT_PATH: "/parse"
    PARSE_SERVER_GRAPHQL_PATH: "/graphql"
    PARSE_SERVER_CLOUD: "/parse-server/cloud/main.js"
    PARSE_SERVER_HOST: "0.0.0.0"
    PORT: "1337"
    
    # File upload configuration
    PARSE_SERVER_ENABLE_ANON_USERS: "true"
    PARSE_SERVER_FILE_UPLOAD_ENABLE_FOR_PUBLIC: "false"
    PARSE_SERVER_FILE_UPLOAD_ENABLE_FOR_ANONYMOUS_USER: "true"
    PARSE_SERVER_FILE_UPLOAD_ENABLE_FOR_AUTHENTICATED_USER: "true"
    PARSE_SERVER_FILE_UPLOAD_FILE_EXTENSIONS: "^[^hH][^tT][^mM][^lL]?$"
    PARSE_SERVER_MAX_UPLOAD_SIZE: "20mb"
    
    # S3 configuration (optional)
    # Note: S3 bucket region should match your deployment region
    # For IAM-based S3 access (recommended), do not set AWS_ACCESS_KEY_ID or AWS_SECRET_ACCESS_KEY
    # Instead, attach an IAM instance profile with S3 permissions to your EB environment
    PARSE_SERVER_S3_BUCKET_ENCRYPTION: "AES256"
    
    # Parse Server security
    PARSE_SERVER_OBJECT_ID_SIZE: "32"
    PARSE_SERVER_ALLOW_CLIENT_CLASS_CREATION: "false"
    PARSE_SERVER_ALLOW_CUSTOM_OBJECTID: "true"
    PARSE_SERVER_DATABASE_ENABLE_SCHEMA_HOOKS: "true"
    PARSE_SERVER_PAGES_ENABLE_ROUTER: "true"
    PARSE_SERVER_DIRECT_ACCESS: "false"
    PARSE_SERVER_ENFORCE_PRIVATE_USERS: "true"
    PARSE_SERVER_MAINTENANCE_KEY_IPS: "127.0.0.1, ::1, 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16"
    PARSE_SERVER_PRIMARY_KEY_IPS: "127.0.0.1, ::1, 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16"
    
    # LiveQuery configuration
    PARSE_SERVER_START_LIVE_QUERY_SERVER: "true"
    PARSE_SERVER_START_LIVE_QUERY_SERVER_NO_PARSE: "false"
    PARSE_SERVER_LIVEQUERY_CLASSNAMES: "Clock, RevisionRecord"
    PARSE_LIVE_QUERY_SERVER_WEBSOCKET_TIMEOUT: "10000"
    PARSE_LIVE_QUERY_SERVER_CACHE_TIMEOUT: "5000"
    
    # Rate limiting
    PARSE_SERVER_RATE_LIMIT: "false"
    PARSE_SERVER_RATE_LIMIT_ERROR_RESPONSE_MESSAGE: "Too many requests."
    PARSE_SERVER_RATE_LIMIT_INCLUDE_INTERNAL_REQUESTS: "false"
    PARSE_SERVER_RATE_LIMIT_INCLUDE_PRIMARY_KEY: "false"
    PARSE_SERVER_RATE_LIMIT_REQUEST_COUNT: "100"
    PARSE_SERVER_RATE_LIMIT_REQUEST_TIME_WINDOW: "600000"
    PARSE_SERVER_RATE_LIMIT_REQUEST_PATH: "*"
    
    # Cache configuration
    PARSE_SERVER_CACHE_MAX_SIZE: "10000"
    PARSE_SERVER_CACHE_TTL: "5000"
    
    # GraphQL configuration
    PARSE_SERVER_MOUNT_GRAPHQL: "false"
    PARSE_SERVER_MOUNT_PLAYGROUND: "false"
    PARSE_SERVER_PLAYGROUND_PATH: "/playground"
    
    # Idempotency configuration
    PARSE_SERVER_ENABLE_IDEMPOTENCY: "false"
    PARSE_SERVER_EXPERIMENTAL_IDEMPOTENCY_PATHS: ".*"
    PARSE_SERVER_EXPERIMENTAL_IDEMPOTENCY_TTL: "300"
    
    # ParseCareKit configuration
    PARSE_SERVER_USING_PARSECAREKIT: "true"
    PARSE_SERVER_USING_PARSECAREKIT_AUDIT: "false"
    
    # Logging configuration
    PARSE_VERBOSE: "false"
    JSON_LOGS: "false"
    PARSE_SERVER_LOGS_FOLDER: "./logs"
    PARSE_SERVER_LOG_LEVELS_TRIGGER_AFTER: "info"
    PARSE_SERVER_LOG_LEVELS_TRIGGER_BEFORE_ERROR: "error"
    PARSE_SERVER_LOG_LEVELS_TRIGGER_BEFORE_SUCCESS: "info"
    
    # Authentication configuration
    PARSE_SERVER_ALLOW_EXPIRED_AUTH_DATA_TOKEN: "true"
    
    # Email verification configuration
    PARSE_SERVER_VERIFY_USER_EMAILS: "false"
    PARSE_SERVER_EMAIL_VERIFY_TOKEN_VALIDITY_DURATION: "86400"
    PARSE_SERVER_EMAIL_VERIFY_TOKEN_REUSE_IF_VALID: "false"
    PARSE_SERVER_PREVENT_LOGIN_WITH_UNVERIFIED_EMAIL: "false"
    
    # Session configuration
    PARSE_SERVER_EXPIRE_INACTIVE_SESSIONS: "true"
    PARSE_SERVER_SESSION_LENGTH: "31536000"
    PARSE_SERVER_REVOKE_SESSION_ON_PASSWORD_RESET: "true"
    PARSE_SERVER_PRESERVE_FILE_NAME: "false"
    
    # Account lockout configuration
    PARSE_SERVER_ACCOUNT_LOCKOUT_DURATION: "5"
    PARSE_SERVER_ACCOUNT_LOCKOUT_THRESHOLD: "3"
    PARSE_SERVER_ACCOUNT_LOCKOUT_UNLOCK_ON_PASSWORD_RESET: "false"
    
    # Password policy configuration
    PARSE_SERVER_PASSWORD_POLICY_DO_NOT_ALLOW_USERNAME: "true"
    PARSE_SERVER_PASSWORD_POLICY_MAX_PASSWORD_HISTORY: "5"
    PARSE_SERVER_PASSWORD_POLICY_RESET_TOKEN_REUSE_IF_VALID: "false"
    PARSE_SERVER_PASSWORD_POLICY_RESET_TOKEN_VALIDITY_DURATION: "86400"
    PARSE_SERVER_PASSWORD_POLICY_VALIDATION_ERROR: "Password must have at least 8 characters, contain at least 1 digit, 1 lower case, 1 upper case, and contain at least one special character."
